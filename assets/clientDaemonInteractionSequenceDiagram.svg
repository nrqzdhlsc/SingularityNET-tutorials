<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1125px" preserveAspectRatio="none" style="width:1319px;height:1125px;" version="1.1" viewBox="0 0 1319 1125" width="1319px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cz4pzkwc5fal" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="257" x="532.25" y="22.9951">"Messages - Sequence Diagram"</text><rect fill="#FFFFFF" filter="url(#f1cz4pzkwc5fal)" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="903" x="13" y="85.5938"/><rect fill="#FFFFFF" filter="url(#f1cz4pzkwc5fal)" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="990" x="13" y="245.125"/><rect fill="#FFFFFF" filter="url(#f1cz4pzkwc5fal)" height="260.0625" style="stroke: #000000; stroke-width: 2.0;" width="1295.5" x="13" y="404.6563"/><rect fill="#FFFFFF" filter="url(#f1cz4pzkwc5fal)" height="201.7969" style="stroke: #000000; stroke-width: 2.0;" width="990" x="13" y="706.7188"/><rect fill="#FFFFFF" filter="url(#f1cz4pzkwc5fal)" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="610.5" x="392.5" y="950.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="68.5938" y2="210.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="210.125" y2="238.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="238.125" y2="369.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="369.6563" y2="397.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="397.6563" y2="671.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="671.7188" y2="699.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="699.7188" y2="915.5156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="51" x2="51" y1="915.5156" y2="943.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="51" y1="943.5156" y2="1085.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="426.5" y1="68.5938" y2="210.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="426.5" x2="426.5" y1="210.125" y2="238.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="426.5" y1="238.125" y2="369.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="426.5" x2="426.5" y1="369.6563" y2="397.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="426.5" y1="397.6563" y2="671.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="426.5" x2="426.5" y1="671.7188" y2="699.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="426.5" y1="699.7188" y2="915.5156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="426.5" x2="426.5" y1="915.5156" y2="943.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="426.5" y1="943.5156" y2="1085.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="885" y1="68.5938" y2="210.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="885" x2="885" y1="210.125" y2="238.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="885" y1="238.125" y2="369.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="885" x2="885" y1="369.6563" y2="397.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="885" y1="397.6563" y2="671.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="885" x2="885" y1="671.7188" y2="699.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="885" y1="699.7188" y2="915.5156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="885" x2="885" y1="915.5156" y2="943.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="885" y1="943.5156" y2="1085.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="954" y1="68.5938" y2="210.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="954" x2="954" y1="210.125" y2="238.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="954" y1="238.125" y2="369.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="954" x2="954" y1="369.6563" y2="397.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="954" y1="397.6563" y2="671.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="954" x2="954" y1="671.7188" y2="699.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="954" y1="699.7188" y2="915.5156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="954" x2="954" y1="915.5156" y2="943.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="954" x2="954" y1="943.5156" y2="1085.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1264.5" x2="1264.5" y1="68.5938" y2="210.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1264.5" x2="1264.5" y1="210.125" y2="238.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1264.5" x2="1264.5" y1="238.125" y2="369.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1264.5" x2="1264.5" y1="369.6563" y2="397.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1264.5" x2="1264.5" y1="397.6563" y2="671.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1264.5" x2="1264.5" y1="671.7188" y2="699.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1264.5" x2="1264.5" y1="699.7188" y2="915.5156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1264.5" x2="1264.5" y1="915.5156" y2="943.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1264.5" x2="1264.5" y1="943.5156" y2="1085.0469"/><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="53.292">Client</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="23" y="1084.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="30" y="1104.042">Client</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="402.5" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="409.5" y="53.292">MPE</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="402.5" y="1084.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="409.5" y="1104.042">MPE</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="37" x="865" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="872" y="53.292">AGI</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="37" x="865" y="1084.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="872" y="1104.042">AGI</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="916" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="923" y="53.292">Daemon</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="916" y="1084.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="923" y="1104.042">Daemon</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="1230.5" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1237.5" y="53.292">Service</text><rect fill="#FEFECE" filter="url(#f1cz4pzkwc5fal)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="1230.5" y="1084.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1237.5" y="1104.042">Service</text><path d="M13,85.5938 L114,85.5938 L114,92.5938 L104,102.5938 L13,102.5938 L13,85.5938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="903" x="13" y="85.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="28" y="98.6606">deposit</text><polygon fill="#FF0000" points="414.5,119.8594,424.5,123.8594,414.5,127.8594,418.5,123.8594" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="51.5" x2="420.5" y1="123.8594" y2="123.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="58.5" y="118.7935">deposit(value)</text><polygon fill="#008000" points="873.5,148.9922,883.5,152.9922,873.5,156.9922,877.5,152.9922" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="426.5" x2="879.5" y1="152.9922" y2="152.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="433.5" y="147.9263">move_tokens(client, MPE, value)</text><line style="stroke: #808080; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="182.125" y2="182.125"/><line style="stroke: #808080; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="182.125" y2="195.125"/><line style="stroke: #808080; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="195.125" y2="195.125"/><polygon fill="#808080" points="437.5,191.125,427.5,195.125,437.5,199.125,433.5,195.125" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="433.5" y="177.0591">balances[client] += value</text><path d="M13,245.125 L157,245.125 L157,252.125 L147,262.125 L13,262.125 L13,245.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="990" x="13" y="245.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="28" y="258.1919">open channel</text><polygon fill="#FF0000" points="414.5,279.3906,424.5,283.3906,414.5,287.3906,418.5,283.3906" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="51.5" x2="420.5" y1="283.3906" y2="283.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="351" x="58.5" y="278.3247">open_channel(service, value, expiration, replica_group)</text><polygon fill="#FF0000" points="942.5,308.5234,952.5,312.5234,942.5,316.5234,946.5,312.5234" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="426.5" x2="948.5" y1="312.5234" y2="312.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="433.5" y="307.4575">event_channel_open(channel)</text><line style="stroke: #808080; stroke-width: 1.0;" x1="51.5" x2="93.5" y1="341.6563" y2="341.6563"/><line style="stroke: #808080; stroke-width: 1.0;" x1="93.5" x2="93.5" y1="341.6563" y2="354.6563"/><line style="stroke: #808080; stroke-width: 1.0;" x1="52.5" x2="93.5" y1="354.6563" y2="354.6563"/><polygon fill="#808080" points="62.5,350.6563,52.5,354.6563,62.5,358.6563,58.5,354.6563" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="58.5" y="336.5903">sum[channel_id] = 0</text><path d="M13,404.6563 L192,404.6563 L192,411.6563 L182,421.6563 L13,421.6563 L13,404.6563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="260.0625" style="stroke: #000000; stroke-width: 2.0;" width="1295.5" x="13" y="404.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="28" y="417.7231">request to service</text><line style="stroke: #808080; stroke-width: 1.0;" x1="51.5" x2="93.5" y1="442.9219" y2="442.9219"/><line style="stroke: #808080; stroke-width: 1.0;" x1="93.5" x2="93.5" y1="442.9219" y2="455.9219"/><line style="stroke: #808080; stroke-width: 1.0;" x1="52.5" x2="93.5" y1="455.9219" y2="455.9219"/><polygon fill="#808080" points="62.5,451.9219,52.5,455.9219,62.5,459.9219,58.5,455.9219" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="58.5" y="437.856">sum[channel_id] += price</text><line style="stroke: #808080; stroke-width: 1.0;" x1="51.5" x2="93.5" y1="485.0547" y2="485.0547"/><line style="stroke: #808080; stroke-width: 1.0;" x1="93.5" x2="93.5" y1="485.0547" y2="498.0547"/><line style="stroke: #808080; stroke-width: 1.0;" x1="52.5" x2="93.5" y1="498.0547" y2="498.0547"/><polygon fill="#808080" points="62.5,494.0547,52.5,498.0547,62.5,502.0547,58.5,498.0547" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="58.5" y="479.9888">payment = sign_payment(channel_id, sum[channel_id])</text><polygon fill="#FF0000" points="942.5,523.1875,952.5,527.1875,942.5,531.1875,946.5,527.1875" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="51.5" x2="948.5" y1="527.1875" y2="527.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="58.5" y="522.1216">request(data, payment)</text><line style="stroke: #808080; stroke-width: 1.0;" x1="954.5" x2="996.5" y1="556.3203" y2="556.3203"/><line style="stroke: #808080; stroke-width: 1.0;" x1="996.5" x2="996.5" y1="556.3203" y2="569.3203"/><line style="stroke: #808080; stroke-width: 1.0;" x1="955.5" x2="996.5" y1="569.3203" y2="569.3203"/><polygon fill="#808080" points="965.5,565.3203,955.5,569.3203,965.5,573.3203,961.5,569.3203" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="961.5" y="551.2544">check_payment(last_channel_state, payment)</text><polygon fill="#008000" points="1252.5,594.4531,1262.5,598.4531,1252.5,602.4531,1256.5,598.4531" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="954.5" x2="1258.5" y1="598.4531" y2="598.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="961.5" y="593.3872">request(data)</text><polygon fill="#008000" points="965.5,623.5859,955.5,627.5859,965.5,631.5859,961.5,627.5859" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="959.5" x2="1263.5" y1="627.5859" y2="627.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="971.5" y="622.52">response(result)</text><polygon fill="#A80036" points="62.5,652.7188,52.5,656.7188,62.5,660.7188,58.5,656.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="953.5" y1="656.7188" y2="656.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="68.5" y="651.6528">response(result)</text><path d="M13,706.7188 L258,706.7188 L258,713.7188 L248,723.7188 L13,723.7188 L13,706.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="201.7969" style="stroke: #000000; stroke-width: 2.0;" width="990" x="13" y="706.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="28" y="719.7856">contract partial withdrawal</text><polygon fill="#FF0000" points="437.5,740.9844,427.5,744.9844,437.5,748.9844,433.5,744.9844" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="431.5" x2="953.5" y1="744.9844" y2="744.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="443.5" y="739.9185">channel_claim(payment, false)</text><line style="stroke: #808080; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="774.1172" y2="774.1172"/><line style="stroke: #808080; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="774.1172" y2="787.1172"/><line style="stroke: #808080; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="787.1172" y2="787.1172"/><polygon fill="#808080" points="437.5,783.1172,427.5,787.1172,437.5,791.1172,433.5,787.1172" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="433.5" y="769.0513">balances[client] -= payment.value</text><line style="stroke: #808080; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="816.25" y2="816.25"/><line style="stroke: #808080; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="816.25" y2="829.25"/><line style="stroke: #808080; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="829.25" y2="829.25"/><polygon fill="#808080" points="437.5,825.25,427.5,829.25,437.5,833.25,433.5,829.25" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="433.5" y="811.1841">balances[service] += payment.value</text><line style="stroke: #808080; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="858.3828" y2="858.3828"/><line style="stroke: #808080; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="858.3828" y2="871.3828"/><line style="stroke: #808080; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="871.3828" y2="871.3828"/><polygon fill="#808080" points="437.5,867.3828,427.5,871.3828,437.5,875.3828,433.5,871.3828" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="445" x="433.5" y="853.3169">newChannel(client, service, value - payment.value, expiration, replica)</text><polygon fill="#FF0000" points="62.5,896.5156,52.5,900.5156,62.5,904.5156,58.5,900.5156" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="56.5" x2="425.5" y1="900.5156" y2="900.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="68.5" y="895.4497">event_channel_open(contract)</text><path d="M392.5,950.5156 L518.5,950.5156 L518.5,957.5156 L508.5,967.5156 L392.5,967.5156 L392.5,950.5156 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="117.5313" style="stroke: #000000; stroke-width: 2.0;" width="610.5" x="392.5" y="950.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="407.5" y="963.5825">withdrawal</text><polygon fill="#FF0000" points="437.5,984.7813,427.5,988.7813,437.5,992.7813,433.5,988.7813" style="stroke: #FF0000; stroke-width: 1.0;"/><line style="stroke: #FF0000; stroke-width: 1.0;" x1="431.5" x2="953.5" y1="988.7813" y2="988.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="443.5" y="983.7153">withdraw(value)</text><line style="stroke: #808080; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="1017.9141" y2="1017.9141"/><line style="stroke: #808080; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="1017.9141" y2="1030.9141"/><line style="stroke: #808080; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="1030.9141" y2="1030.9141"/><polygon fill="#808080" points="437.5,1026.9141,427.5,1030.9141,437.5,1034.9141,433.5,1030.9141" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="433.5" y="1012.8481">balances[service] -= value</text><polygon fill="#008000" points="873.5,1056.0469,883.5,1060.0469,873.5,1064.0469,877.5,1060.0469" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="426.5" x2="879.5" y1="1060.0469" y2="1060.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="433.5" y="1054.981">move_tokens(MPE, service, value)</text><!--
@startuml
title "Messages - Sequence Diagram"

group deposit
Client -[#red]> MPE : deposit(value)
MPE -[#green]> AGI : move_tokens(client, MPE, value)
MPE -[#gray]> MPE : balances[client] += value
end
...
group open channel
Client -[#red]> MPE : open_channel(service, value, expiration, replica_group)
MPE -[#red]> Daemon : event_channel_open(channel)
Client -[#gray]> Client : sum[channel_id] = 0
end
...
group request to service
Client -[#gray]> Client : sum[channel_id] += price
Client -[#gray]> Client : payment = sign_payment(channel_id, sum[channel_id])
Client -[#red]> Daemon : request(data, payment)
Daemon -[#gray]> Daemon : check_payment(last_channel_state, payment)
Daemon -[#green]> Service : request(data)
Service -[#green]> Daemon : response(result)
Daemon -> Client : response(result)
end
...
group contract partial withdrawal
Daemon -[#red]> MPE : channel_claim(payment, false)
MPE -[#gray]> MPE : balances[client] -= payment.value
MPE -[#gray]> MPE : balances[service] += payment.value
MPE -[#gray]> MPE : newChannel(client, service, value - payment.value, expiration, replica)
MPE -[#red]> Client : event_channel_open(contract)
end
...
group withdrawal
Daemon -[#red]> MPE : withdraw(value)
MPE -[#gray]> MPE : balances[service] -= value
MPE -[#green]> AGI : move_tokens(MPE, service, value)
end
@enduml

PlantUML version 1.2018.11(Sat Sep 22 16:43:53 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>